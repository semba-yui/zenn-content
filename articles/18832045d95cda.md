---
title: "バージョン管理ツール asdf 導入方法"
emoji: "🔰"
type: "tech"
topics:
  - "dotnet"
  - "asdf"
  - "バージョン管理"
  - "rtx"
  - "mise"
published: true
published_at: "2024-01-12 17:15"
---

# asdf とは

[asdf](https://asdf-vm.com) とは、各種言語やFW・ツールなどを一括でバージョン管理できるツールです。

# asdf の特徴

- 多言語対応
	- asdfは Java, Ruby, Python 等のプログラミング言語だけでなく、.NET, Node.js 等のフレームワーク、gralde 等のビルドツール等、多岐にわたります。
- プラグインシステム
	- 様々な言語やツールに対応するためのプラグインシステムを持っており、必要に応じてプラグインを追加することができます。
- バージョンの指定
	- プロジェクトごとに異なるバージョンの言語やツールを指定できます。
	- `.tool-versions` ファイルにバージョンを記述して git 管理を行うことで、そのプロジェクトで使用するバージョンを管理できます。
- シンプルなコマンド
	- バージョンのインストール、切り替え、一覧表示などを簡単なコマンドで行うことができます。数回実施してれば覚えられるのでいちいちググる手間が省けます。
- 動作の軽量さ
	- 競合である anyenv と比較して、体感 asdf のほうが圧倒的に早いです。


# 手順

ここでは、例として .NET を asdf を利用してインストールします。

## 前提条件

- パッケージマネージャー: [HomeBrew](https://brew.sh)
- シェル: zsh

## asdf のインストール

まず、最初に HomeBrew を利用し、asdf をインストールします。

```Shell
brew install asdf
```

インストール完了後、shell 起動時に読み込まれるようにパスを通します。

```Shell
echo -e "\n. $(brew --prefix asdf)/libexec/asdf.sh" >> ${ZDOTDIR:-~}/.zshrc
```

シェルを再起動します。

```Shell
exec $SHELL
```

asdf へのパスが通っていればインストール完了です。

```Shell
$ asdf --version
v0.13.1
```

## プラグインの追加

asdf はバージョン管理する対象をプラグイン形式で追加します。

:::message
管理可能なプラグイン一覧が見たい場合は以下のコマンドを実行してください。
※量が多いので Grep 等で絞り込みながら実行するのをおすすめします。
```Shell
asdf plugin list all
```
:::

### .NET プラグインの追加

ここでは、例として .NET を追加します。

```Shell
asdf plugin add dotnet
```

### 結果確認

以下のコマンドで追加が確認できると OK です。

```Shell
asdf plugin list
```

#### 実行結果

```Shell
$ asdf plugin list
dotnet
```

## 対象バージョンの追加

プラグインを追加したら、続いて対象のバージョンを指定してインストールしていきます。

### インストール可能なバージョン一覧を確認

以下のコマンドでインストール可能なバージョン一覧を確認します。

```Shell
$ asdf list-all dotnet
```

#### 実行結果

```Shell
$ asdf list-all dotnet
1.1.14
1.1.14
2.1.202
2.1.818
2.2.207
3.0.103
3.1.426
5.0.408
6.0.417
7.0.404
8.0.100
```

### 対象のバージョンをインストール

対象のバージョンが見つかったら、インストールしていきます。
今回は `6.0.417` をインストールします。

```Shell
asdf install dotnet 6.0.417
```

ここで複数バージョンをインストールしておくことも可能です。
latest を指定して、最新の 8.0.100 もインストールしてみます。

```Shell
asdf install dotnet latest
```

### 結果確認

以下のコマンドを実行することでインストールされたバージョン一覧を確認できます。

```Shell
asdf list dotnet
```

#### 実行結果

2種類のバージョンがインストールされています。

```Shell
$ asdf list dotnet
  6.0.417
  8.0.100
```

## バージョンの有効化

asdf はインストールのみですぐに利用できるわけではありません。
global（シェル全体）、もしくは作業したいディレクトリ配下にてバージョンを指定して有効化をすることで利用可能になります。

### global バージョンとして有効化したい場合

以下のコマンドを実行することで、全てのディレクトリにおいて .NET の `6.0.417` バージョンが利用可能となります。

```Shell
asdf global dotnet 6.0.417
```

#### 結果確認

```Shell
$ dotnet --version
6.0.417
```

#### バージョンの変更

バージョンを `6.0.417` から `8.0.100` に切り替えたい場合、有効化したときと同様な以下のコマンドで変更します。

```Shell
asdf global dotnet 8.0.100
```

#### 結果確認

```Shell
$ dotnet --version
8.0.100
```

### 特定のディレクトリ配下のみ有効化したい場合

以下のコマンドを実行することで、実行したディレクトリとその配下において .NET の `6.0.417` バージョンが利用可能となります。

```Shell
asdf local dotnet 6.0.417
```

これにより、コマンドを実行したディレクトリに `.tool-versions` というファイルが作成されます。
これを git 管理することで利用者全員でバージョンを統一しつつ、かつ利用するバージョンを明示的に git に残すことも可能です。

```Shell
$ cat .tool-versions
dotnet 6.0.417
```

#### 結果確認

```Shell
$ dotnet --version
6.0.417
```

## プラグインの追加などがうまくいかない・反映されない場合

以下のコマンドを実行してから再度試してみるとうまくいくことがあります。

```Shell
asdf reshim
```

# 参考

- https://asdf-vm.com
- https://github.com/asdf-vm
- https://formulae.brew.sh/formula/asdf

# 備考 【asdfの更に上位互換ツール？のご紹介】

mise(旧rtx) という asdf の更に上位互換的なツールも存在しているそうです。
こちらも使ってみて良さそうであれば記事にします。

- https://mise.jdx.dev